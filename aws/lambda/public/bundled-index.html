<!DOCTYPE html><html lang="en"><head>
<!-- Bundled by AWS Lambda HTML Bundler -->
<!-- Generated at: 2025-08-08T14:22:31.290Z -->
<!-- Optimizations: CSS/JS inlined, HTML minified -->
<meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><title>GitHub PR Analysis</title><style>
body {font-family:Arial,sans-serif;margin:0;padding:0;background-color:#f0f0f0} .auth-container {display:flex;justify-content:center;align-items:center;min-height:100vh;background-color:#f5f5f5} .auth-content {background:white;padding:2rem;border-radius:8px;box-shadow:0 4px 6px rgba(0,0,0,0.1);text-align:center;max-width:400px;width:90%} .auth-content h2 {margin-bottom:1.5rem;color:#333} .auth-button {background-color:#007bff;color:white;border:none;padding:12px 24px;border-radius:6px;cursor:pointer;font-size:16px;transition:background-color 0.3s} .auth-button:hover {background-color:#0056b3} .user-info {display:flex;justify-content:space-between;align-items:center;padding:1rem;background-color:#f8f9fa;border-radius:6px;margin-bottom:1rem} .logout-button {background-color:#dc3545;color:white;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;font-size:14px} .logout-button:hover {background-color:#c82333} .container {max-width:95%;margin:0 auto;padding:20px} h1 {text-align:center;color:#333} .chart-container {width:100%;height:100%;background-color:white;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.1);margin-bottom:20px;padding:10px} .input-container {margin:0 10px;display:flex;justify-content:center;align-items:center;margin-bottom:5px} .input-container button {background-color:#4caf50;border:2px solid transparent;color:white;padding:5px 5px;text-align:center;text-decoration:none;display:inline-block;font-size:16px;margin:4px 2px;cursor:pointer;border-radius:5px;margin-left:15px} #runButton:hover {background-color:#cff160;border:2px solid #4caf50;color:#4caf50} .template-inputs {margin:0 10px;display:flex;justify-content:center;align-items:center;margin-bottom:5px} .template-inputs button {background-color:#a9f53d8e;border:2px solid transparent;color:rgb(1,77,1);padding:10px 10px;text-align:center;text-decoration:none;display:inline-block;font-size:16px;margin:4px 2px;cursor:pointer;border-radius:10px;margin-left:15px} .template-inputs button:hover {background-color:#cff160;border:2px solid #4caf50;color:#4caf50} #teamSelect,#fromDateInput,#toDateInput {margin:0 10px;margin-right:20px;padding:5px;font-size:12px;border:1px solid #ccc;border-radius:5px} #teamSelect {min-width:120px} .loading-container {position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,0.8);display:flex;justify-content:center;align-items:center;z-index:9999} #result {text-align:center;visibility:hidden;font-size:1.5em;margin-bottom:5px;color:indianred} .modal {display:none;position:fixed;z-index:1;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,0.4)} .modal-content {background-color:#fefefe;margin:15% auto;padding:20px;border:1px solid #888;width:80%} .close {color:#aaa;float:right;font-size:28px;font-weight:bold;cursor:pointer} .close:hover,.close:focus {color:black;text-decoration:none;cursor:pointer} .pr-table {width:100%;border-collapse:collapse;margin-top:20px} .pr-table th,.pr-table td {border:1px solid #ddd;padding:8px;text-align:left} .pr-table-author th {background-color:#9ad1f5bc} .pr-table-requested th {background-color:#ffb1c1bc } .pr-table .closed {color:#999999} .pr-table th:nth-child(1),.pr-table td:nth-child(1) {width:8%} .pr-table th:nth-child(2),.pr-table td:nth-child(2) {width:8%} .pr-table th:nth-child(3),.pr-table td:nth-child(3) {width:4%} .pr-table th:nth-child(4),.pr-table td:nth-child(4) {width:4%} .pr-table th:nth-child(5),.pr-table td:nth-child(5) {width:30%} .pr-table th:nth-child(6),.pr-table td:nth-child(6) {width:4%} .pr-table th:nth-child(7),.pr-table td:nth-child(7) {width:4%} .pr-table th:nth-child(8),.pr-table td:nth-child(8) {width:4%} .pr-table .closed {color:#999999} .pr-table .completed {color:#999999} .completed-toggle {margin:0} .completed-toggle label {display:flex;align-items:center;cursor:pointer;font-size:14px;color:#666;margin:0} .completed-toggle input[type="checkbox"] {margin-right:5px} .multi-select-dropdown {position:relative;min-width:250px;max-width:400px;font-size:14px} .multi-select-header {display:flex;justify-content:space-between;align-items:center;padding:8px 12px;border:1px solid #ccc;border-radius:5px;background-color:white;cursor:pointer;transition:border-color 0.3s} .multi-select-header:hover {border-color:#4caf50} .multi-select-dropdown.open .multi-select-header {border-color:#4caf50;border-bottom-left-radius:0;border-bottom-right-radius:0} .multi-select-selected-display {flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap} .multi-select-placeholder {color:#999} .multi-select-selected-count {color:#333;font-weight:500} .multi-select-arrow {margin-left:10px;font-size:10px;color:#666;transition:transform 0.3s} .multi-select-dropdown.open .multi-select-arrow {transform:rotate(180deg)} .multi-select-dropdown-content {position:absolute;top:100%;left:0;right:0;background:white;border:1px solid #4caf50;border-top:none;border-bottom-left-radius:5px;border-bottom-right-radius:5px;box-shadow:0 4px 6px rgba(0,0,0,0.1);z-index:1000;max-height:300px;overflow:hidden;display:flex;flex-direction:column} .multi-select-search-container {padding:8px;border-bottom:1px solid #eee} .multi-select-search {width:100%;padding:6px 10px;border:1px solid #ddd;border-radius:3px;font-size:14px} .multi-select-search:focus {outline:none;border-color:#4caf50} .multi-select-actions {display:flex;gap:8px;padding:8px;border-bottom:1px solid #eee} .multi-select-actions button {flex:1;padding:6px 12px;background:#f0f0f0;border:1px solid #ddd;border-radius:3px;font-size:12px;cursor:pointer;transition:background-color 0.2s} .multi-select-actions button:hover {background:#e0e0e0} .multi-select-items-container {flex:1;overflow-y:auto;max-height:200px} .multi-select-items {padding:4px 0} .multi-select-item {display:flex;align-items:center;padding:6px 12px;cursor:pointer;transition:background-color 0.2s} .multi-select-item:hover {background-color:#f5f5f5} .multi-select-item input[type="checkbox"] {margin-right:8px;cursor:pointer} .multi-select-item label {flex:1;cursor:pointer;user-select:none} .multi-select-group {margin-bottom:8px} .multi-select-group-header {padding:6px 12px;background-color:#f8f8f8;font-weight:bold;font-size:12px;color:#666;text-transform:uppercase;border-top:1px solid #eee;border-bottom:1px solid #eee} .multi-select-no-results {padding:20px;text-align:center;color:#999} .multi-select-dropdown.disabled {opacity:0.6} .multi-select-dropdown.disabled .multi-select-header {cursor:not-allowed} .team-selection-container {display:flex;align-items:center;gap:10px;margin:0 10px} .team-selection-label {font-weight:500;color:#333} #teamDropdown {flex:0 1 auto} .autocomplete-container {position:relative;width:100%} .autocomplete-input-wrapper {display:flex;flex-wrap:wrap;align-items:center;gap:4px;padding:6px 8px;border:1px solid #ccc;border-radius:5px;background-color:white;cursor:text;transition:border-color 0.3s;min-height:34px} .autocomplete-input-wrapper:hover {border-color:#4caf50} .autocomplete-container.open .autocomplete-input-wrapper,.autocomplete-input-wrapper:focus-within {border-color:#4caf50} .autocomplete-input {flex:1;border:none;outline:none;background:transparent;font-size:14px;min-width:100px;padding:2px 0} .autocomplete-tags {display:flex;flex-wrap:wrap;gap:4px} .autocomplete-tag {display:flex;align-items:center;background-color:#e3f2fd;border:1px solid #2196f3;border-radius:16px;padding:2px 8px;font-size:12px;color:#1976d2;max-width:150px} .autocomplete-tag-text {overflow:hidden;text-overflow:ellipsis;white-space:nowrap} .autocomplete-tag-remove {background:none;border:none;color:#1976d2;cursor:pointer;font-size:14px;font-weight:bold;margin-left:4px;padding:0;width:16px;height:16px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:background-color 0.2s} .autocomplete-tag-remove:hover {background-color:rgba(25,118,210,0.1)} .autocomplete-suggestions {position:absolute;top:100%;left:0;right:0;background:white;border:1px solid #4caf50;border-top:none;border-radius:0 0 5px 5px;box-shadow:0 4px 6px rgba(0,0,0,0.1);z-index:1000;max-height:200px;overflow-y:auto} .autocomplete-suggestion {padding:8px 12px;cursor:pointer;transition:background-color 0.2s;border-bottom:1px solid #f0f0f0} .autocomplete-suggestion:last-child {border-bottom:none} .autocomplete-suggestion:hover,.autocomplete-suggestion.focused {background-color:#f5f5f5} .autocomplete-suggestion mark {background-color:#ffeb3b;padding:0 2px;border-radius:2px} .autocomplete-no-results {padding:12px;text-align:center;color:#999;font-style:italic} .autocomplete-container.disabled {opacity:0.6;pointer-events:none} .users-input-container {display:flex;align-items:center;gap:10px;margin:0 10px} .users-input-label {font-weight:500;color:#333;white-space:nowrap} #usersAutocomplete {flex:1;min-width:200px;max-width:300px}
</style><style>
.sk-circle {position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform:scale(4)} .sk-circle .sk-child {width:100%;height:100%;position:absolute;left:0;top:0} .sk-circle .sk-child:before {content:'';display:block;margin:0 auto;width:15%;height:15%;background-color:#333;border-radius:100%;-webkit-animation:sk-circleBounceDelay 1.2s infinite ease-in-out both;animation:sk-circleBounceDelay 1.2s infinite ease-in-out both} .sk-circle .sk-circle2 {-webkit-transform:rotate(30deg);-ms-transform:rotate(30deg);transform:rotate(30deg)} .sk-circle .sk-circle3 {-webkit-transform:rotate(60deg);-ms-transform:rotate(60deg);transform:rotate(60deg)} .sk-circle .sk-circle4 {-webkit-transform:rotate(90deg);-ms-transform:rotate(90deg);transform:rotate(90deg)} .sk-circle .sk-circle5 {-webkit-transform:rotate(120deg);-ms-transform:rotate(120deg);transform:rotate(120deg)} .sk-circle .sk-circle6 {-webkit-transform:rotate(150deg);-ms-transform:rotate(150deg);transform:rotate(150deg)} .sk-circle .sk-circle7 {-webkit-transform:rotate(180deg);-ms-transform:rotate(180deg);transform:rotate(180deg)} .sk-circle .sk-circle8 {-webkit-transform:rotate(210deg);-ms-transform:rotate(210deg);transform:rotate(210deg)} .sk-circle .sk-circle9 {-webkit-transform:rotate(240deg);-ms-transform:rotate(240deg);transform:rotate(240deg)} .sk-circle .sk-circle10 {-webkit-transform:rotate(270deg);-ms-transform:rotate(270deg);transform:rotate(270deg)} .sk-circle .sk-circle11 {-webkit-transform:rotate(300deg);-ms-transform:rotate(300deg);transform:rotate(300deg)} .sk-circle .sk-circle12 {-webkit-transform:rotate(330deg);-ms-transform:rotate(330deg);transform:rotate(330deg)} .sk-circle .sk-circle2:before {-webkit-animation-delay:-1.1s;animation-delay:-1.1s} .sk-circle .sk-circle3:before {-webkit-animation-delay:-1s;animation-delay:-1s} .sk-circle .sk-circle4:before {-webkit-animation-delay:-0.9s;animation-delay:-0.9s} .sk-circle .sk-circle5:before {-webkit-animation-delay:-0.8s;animation-delay:-0.8s} .sk-circle .sk-circle6:before {-webkit-animation-delay:-0.7s;animation-delay:-0.7s} .sk-circle .sk-circle7:before {-webkit-animation-delay:-0.6s;animation-delay:-0.6s} .sk-circle .sk-circle8:before {-webkit-animation-delay:-0.5s;animation-delay:-0.5s} .sk-circle .sk-circle9:before {-webkit-animation-delay:-0.4s;animation-delay:-0.4s} .sk-circle .sk-circle10:before {-webkit-animation-delay:-0.3s;animation-delay:-0.3s} .sk-circle .sk-circle11:before {-webkit-animation-delay:-0.2s;animation-delay:-0.2s} .sk-circle .sk-circle12:before {-webkit-animation-delay:-0.1s;animation-delay:-0.1s} @-webkit-keyframes sk-circleBounceDelay {0%,80%,100% {-webkit-transform:scale(0);transform:scale(0)} 40% {-webkit-transform:scale(1);transform:scale(1)} } @keyframes sk-circleBounceDelay {0%,80%,100% {-webkit-transform:scale(0);transform:scale(0)} 40% {-webkit-transform:scale(1);transform:scale(1)} }
</style><linkrel="stylesheet"href="https://cdnjs.cloudflare.com/ajax/libs/spinkit/2.0.1/spinkit.min.css"/><script src="https://cdn.jsdelivr.net/npm/chart.js"></script><script src="https://sdk.amazonaws.com/js/aws-sdk-2.1691.0.min.js"></script><script src="https://unpkg.com/@aws-amplify/auth@latest/dist/aws-amplify-auth.min.js"></script></head><body><div id="loading" class="loading-container" style="display: none"><div class="sk-circle"><div class="sk-circle1 sk-child"></div><div class="sk-circle2 sk-child"></div><div class="sk-circle3 sk-child"></div><div class="sk-circle4 sk-child"></div><div class="sk-circle5 sk-child"></div><div class="sk-circle6 sk-child"></div><div class="sk-circle7 sk-child"></div><div class="sk-circle8 sk-child"></div><div class="sk-circle9 sk-child"></div><div class="sk-circle10 sk-child"></div><div class="sk-circle11 sk-child"></div><div class="sk-circle12 sk-child"></div></div></div><div id="auth-container" class="auth-container" style="display: none;"><div class="auth-content"><h2>Login Required</h2><button id="login-button" class="auth-button">Login with AWS Cognito</button></div></div><div id="main-container" class="container" style="display: none;"><div class="user-info"><span id="user-email"></span><button id="logout-button" class="logout-button">Logout</button></div><h1>GitHub PR Analysis</h1><div class="input-container"><div class="team-selection-container"><span class="team-selection-label">Teams:</span><div id="teamDropdown"></div></div><div class="users-input-container"><span class="users-input-label">Users:</span><div id="usersAutocomplete"></div></div><button id="updateTeamsButton">Team Update</button><a>from</a><input type="date" id="fromDateInput" /><a>to</a><input type="date" id="toDateInput" /><button id="runButton">Update</button></div><div class="template-inputs"><button id="weekly-btn">Weekly</button><button id="monthly-btn">Monthly</button></div><div id="result"></div><div class="chart-container"><canvas id="reviewChart"></canvas></div><div id="prModal" class="modal"><div class="modal-content"><span class="close">&times;</span><div id="prModalContent"></div></div></div><template id="pr-table-template"><table class="pr-table"><thead><tr><th>Open</th><th>Close</th><th>Lifetime</th><th>FirstReview</th><th>Title</th><th>Status</th><th>Coments</th><th>Link</th></tr></thead><tbody></tbody></table></template><template id="completed-toggle-template"><div class="completed-toggle"><label><input type="checkbox" id="showCompletedToggle">レビュー済みPRも表示</label></div></template></div><script>
/*** AWS Cognito認証管理クラス* ユーザー認証とJWTトークン管理を担当*/class CognitoAuth {constructor() {this.cognitoConfig = {region: 'ap-northeast-1', // 東京リージョンuserPoolId: process.env.COGNITO_USER_POOL_ID || 'ap-northeast-1_XXXXXXXXX',userPoolWebClientId: process.env.COGNITO_CLIENT_ID || 'XXXXXXXXXXXXXXXXXXXXXXXXX',oauth: {domain: process.env.COGNITO_DOMAIN || 'your-domain.auth.ap-northeast-1.amazoncognito.com',scope: ['openid', 'email', 'profile'],redirectSignIn: window.location.origin,redirectSignOut: window.location.origin,responseType: 'code'}};this.currentUser = null;this.idToken = null;this.accessToken = null;this.init();}/*** 初期化処理*/async init() {try {// AWS SDK設定AWS.config.region = this.cognitoConfig.region;// Cognito Identity Provider設定this.cognitoIdentityServiceProvider = new AWS.CognitoIdentityServiceProvider({region: this.cognitoConfig.region});// User Pool設定this.userPool = new AmazonCognitoIdentity.CognitoUserPool({UserPoolId: this.cognitoConfig.userPoolId,ClientId: this.cognitoConfig.userPoolWebClientId});// 認証状態を確認await this.checkAuthState();// イベントリスナー設定this.setupEventListeners();} catch (error) {console.error('Cognito initialization error:', error);this.showAuthContainer();}}/*** 認証状態を確認*/async checkAuthState() {try {// URLからauthorization codeを確認（OAuth callbackの場合）const urlParams = new URLSearchParams(window.location.search);const authCode = urlParams.get('code');if (authCode) {await this.handleOAuthCallback(authCode);return;}// 既存のセッションを確認const currentUser = this.userPool.getCurrentUser();if (currentUser) {await this.refreshSession(currentUser);} else {this.showAuthContainer();}} catch (error) {console.error('Auth state check error:', error);this.showAuthContainer();}}/*** OAuth コールバック処理*/async handleOAuthCallback(authCode) {try {// Authorization codeをtokenに交換const tokenResponse = await this.exchangeCodeForTokens(authCode);this.idToken = tokenResponse.id_token;this.accessToken = tokenResponse.access_token;// ユーザー情報を取得const userInfo = this.parseJwtToken(this.idToken);this.currentUser = userInfo;// URL cleanupwindow.history.replaceState({}, document.title, window.location.pathname);this.showMainContainer();} catch (error) {console.error('OAuth callback error:', error);this.showAuthContainer();}}/*** Authorization code を token に交換*/async exchangeCodeForTokens(authCode) {const tokenUrl = `https://${this.cognitoConfig.oauth.domain}/oauth2/token`;const params = new URLSearchParams({grant_type: 'authorization_code',client_id: this.cognitoConfig.userPoolWebClientId,code: authCode,redirect_uri: window.location.origin});const response = await fetch(tokenUrl, {method: 'POST',headers: {'Content-Type': 'application/x-www-form-urlencoded'},body: params.toString()});if (!response.ok) {throw new Error('Token exchange failed');}return await response.json();}/*** セッションを更新*/async refreshSession(cognitoUser) {return new Promise((resolve, reject) => {cognitoUser.getSession((err, session) => {if (err) {reject(err);return;}if (session.isValid()) {this.idToken = session.getIdToken().getJwtToken();this.accessToken = session.getAccessToken().getJwtToken();const userInfo = this.parseJwtToken(this.idToken);this.currentUser = userInfo;this.showMainContainer();resolve(session);} else {this.showAuthContainer();reject(new Error('Session is not valid'));}});});}/*** JWT トークンをパース*/parseJwtToken(token) {try {const base64Url = token.split('.')[1];const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);}).join(''));return JSON.parse(jsonPayload);} catch (error) {console.error('JWT parse error:', error);return null;}}/*** ログイン処理*/login() {const authUrl = `https://${this.cognitoConfig.oauth.domain}/oauth2/authorize` +`?client_id=${this.cognitoConfig.userPoolWebClientId}` +`&response_type=code` +`&scope=openid+email+profile` +`&redirect_uri=${encodeURIComponent(window.location.origin)}`;window.location.href = authUrl;}/*** ログアウト処理*/logout() {const currentUser = this.userPool.getCurrentUser();if (currentUser) {currentUser.signOut();}this.currentUser = null;this.idToken = null;this.accessToken = null;const logoutUrl = `https://${this.cognitoConfig.oauth.domain}/logout` +`?client_id=${this.cognitoConfig.userPoolWebClientId}` +`&logout_uri=${encodeURIComponent(window.location.origin)}`;window.location.href = logoutUrl;}/*** 認証が必要なAPIリクエスト用のヘッダーを取得*/getAuthHeaders() {if (!this.idToken) {throw new Error('No authentication token available');}return {'Authorization': `Bearer ${this.idToken}`,'Content-Type': 'application/json'};}/*** 認証コンテナを表示*/showAuthContainer() {document.getElementById('auth-container').style.display = 'block';document.getElementById('main-container').style.display = 'none';}/*** メインコンテナを表示*/showMainContainer() {document.getElementById('auth-container').style.display = 'none';document.getElementById('main-container').style.display = 'block';if (this.currentUser && this.currentUser.email) {document.getElementById('user-email').textContent = this.currentUser.email;}}/*** イベントリスナー設定*/setupEventListeners() {document.getElementById('login-button')?.addEventListener('click', () => {this.login();});document.getElementById('logout-button')?.addEventListener('click', () => {this.logout();});}/*** ユーザーが認証済みかどうかを確認*/isAuthenticated() {return this.currentUser !== null && this.idToken !== null;}/*** 現在のユーザー情報を取得*/getCurrentUser() {return this.currentUser;}}// グローバルインスタンスconst cognitoAuth = new CognitoAuth();
</script><script>
/*** 日付関連のユーティリティクラス*/class DateUtils {/*** 日付をYYYY-MM-DD形式にフォーマット* @param {Date} date - 日付オブジェクト* @returns {string} フォーマットされた日付文字列*/formatDate(date) {const year = date.getFullYear();const month = String(date.getMonth() + 1).padStart(2, "0");const day = String(date.getDate()).padStart(2, "0");return `${year}-${month}-${day}`;}/*** 指定日数前の日付を取得* @param {number} daysAgo - 何日前か* @returns {string} YYYY-MM-DD形式の日付*/getDaysAgo(daysAgo) {const date = new Date(Date.now() - daysAgo * 24 * 60 * 60 * 1000);return date.toISOString().split('T')[0];}/*** 今日の日付を取得* @returns {string} YYYY-MM-DD形式の今日の日付*/getToday() {return new Date().toISOString().split('T')[0];}/*** 2つの日付間の日数差を計算* @param {string} date1 - 日付1 (YYYY-MM-DD)* @param {string} date2 - 日付2 (YYYY-MM-DD)* @returns {number} 日数差*/dateDiffInDays(date1, date2) {const dt1 = new Date(date1);const dt2 = new Date(date2);// UTC日付に変換（時差の影響を排除）const utc1 = Date.UTC(dt1.getFullYear(), dt1.getMonth(), dt1.getDate());const utc2 = Date.UTC(dt2.getFullYear(), dt2.getMonth(), dt2.getDate());// 日数の差を計算（ミリ秒を日に変換）const diffDays = Math.floor((utc2 - utc1) / (1000 * 60 * 60 * 24));return diffDays;}}</script><script>
/*** 通知とローディング表示を管理するクラス*/class NotificationManager {constructor() {this.resultDiv = document.getElementById("result");this.loading = document.getElementById('loading');}/*** ローディング表示を開始* @param {string} message - 表示メッセージ*/showLoading(message = "Loading...") {if (this.resultDiv) {this.resultDiv.textContent = message;this.resultDiv.style.visibility = "visible";}if (this.loading) {this.loading.style.display = 'block';}}/*** ローディング表示を終了*/hideLoading() {if (this.loading) {this.loading.style.display = 'none';}}/*** 成功メッセージを表示* @param {string} message - 表示メッセージ* @param {number} duration - 表示時間（ミリ秒）*/showSuccess(message = "Successfully data updated", duration = 5000) {if (this.resultDiv) {this.resultDiv.textContent = message;this.resultDiv.style.visibility = "visible";setTimeout(() => {this.resultDiv.style.visibility = "hidden";}, duration);}}/*** エラーメッセージを表示* @param {string} message - エラーメッセージ*/showError(message = "Failed to fetch or display data") {if (this.resultDiv) {this.resultDiv.textContent = message;this.resultDiv.style.visibility = "visible";}}/*** アラートを表示* @param {string} message - アラートメッセージ*/showAlert(message) {alert(message);}}</script><script>
/*** GitHub API との通信を担当するサービスクラス*/class GitHubApiService {/*** 指定した期間のGitHubデータを取得* @param {string} fromDate - 開始日 (YYYY-MM-DD)* @param {string} toDate - 終了日 (YYYY-MM-DD)* @param {Array<string>} teams - チーム名の配列* @param {Array<string>} users - ユーザー名の配列* @returns {Promise<Object>} GitHub データ*/async fetchData(fromDate, toDate, teams = [], users = []) {const response = await fetch('/run-python', {method: 'POST',headers: {'Content-Type': 'application/json'},body: JSON.stringify({ fromDate, toDate, teams, users })});if (!response.ok) {throw new Error(`HTTP error! status: ${response.status}`);}return await response.json();}/*** レビューデータを取得* @returns {Promise<Object>} レビューデータ*/async getReviewData() {const response = await fetch('/api/review-data', {method: 'GET',headers: {'Content-Type': 'application/json'}});if (!response.ok) {throw new Error(`HTTP error! status: ${response.status}`);}return await response.json();}/*** チーム情報を取得* @returns {Promise<Object>} チーム情報*/async getTeams() {const response = await fetch('/api/teams', {method: 'GET'});if (!response.ok) {throw new Error(`HTTP error! status: ${response.status}`);}return await response.json();}/*** チーム情報を更新* @returns {Promise<Object>} 更新結果*/async updateTeams() {const response = await fetch('/update-teams', {method: 'POST'});if (!response.ok) {throw new Error(`HTTP error! status: ${response.status}`);}return await response.json();}}</script><script>
/*** データの処理とフィルタリングを担当するクラス*/class DataProcessor {constructor() {this.nonMemberLabels = [];}/*** 非メンバーをフィルタリング* @param {Object} data - 元データ* @returns {Object} フィルタリング済みデータ*/filterNonMembers(data) {const labelsToRemove = data.labels.filter((label) =>this.nonMemberLabels.includes(label));const labelsToRemoveIndex = labelsToRemove.map((label) =>data.labels.indexOf(label));// ラベルとデータセットから対象者を削除data.labels = data.labels.filter((_, index) => !labelsToRemoveIndex.includes(index));data.datasets.forEach((dataset) => {dataset.data = dataset.data.filter((_, index) => !labelsToRemoveIndex.includes(index));});return data;}/*** データセットの順番と色を設定* @param {Object} data - データ* @returns {Object} 設定済みデータ*/configureDatasets(data) {data.datasets = [data.datasets[2], data.datasets[1], data.datasets[0]];data.datasets[0].backgroundColor = "#439D64";data.datasets[1].backgroundColor = "#FF6565";data.datasets[2].backgroundColor = "#40A2C0";return data;}/*** 最大PR数を計算* @param {Object} prData - PRデータ* @returns {number} 最大PR数*/calcMaxPrNum(prData) {let maxPrNum = 0;for (let memberIdx = 0; memberIdx < prData.labels.length; memberIdx++) {let sum = 0;for (let datasetIdx = 0;datasetIdx < prData.datasets.length;datasetIdx++) {const prNum = prData.datasets[datasetIdx].data[memberIdx];sum += prNum;}if (sum > maxPrNum) {maxPrNum = sum;}}return maxPrNum;}/*** PRデータをフィルタリング* @param {Array} prData - PRデータ配列* @param {string} person - 対象者* @returns {Object} フィルタリング済みPRデータ*/filterPRsByPerson(prData, person) {return {authorPrs: prData.filter((item) => item.author.includes(person)),requestedPrs: prData.filter((item) =>item.requested.some((req) => req.includes(person))),completedPrs: prData.filter((item) =>item.completed.some((req) => req.includes(person))),};}}</script><script>
/*** Chart.js を使用したチャート管理クラス*/class ChartManager {constructor(canvasId, dataProcessor) {this.canvasId = canvasId;this.dataProcessor = dataProcessor;this.chart = null;}/*** チャートのタイトルを生成* @param {Object} data - チャートデータ* @param {string} fromDate - 開始日* @param {string} toDate - 終了日* @returns {string} タイトル文字列*/getChartTitle(data, fromDate, toDate) {let title = "Review Activity";// チーム名が含まれている場合は、タイトルに追加if (data.team) {// カンマで区切られた複数のチーム名の場合if (data.team.includes(",")) {title += ` in ${data.team} Teams`;} else {title += ` in ${data.team} Team`;}} else {title += " in All Teams";}title += ` from ${fromDate} to ${toDate}`;return title;}/*** チャート設定オプションを作成* @param {Object} data - チャートデータ* @param {Function} onClickCallback - クリック時のコールバック* @returns {Object} チャート設定オプション*/createChartOptions(data, onClickCallback) {const fromDate = data["period"][0];const toDate = data["period"][1];const maxPrNum = this.dataProcessor.calcMaxPrNum(data);return {responsive: true,scales: {x: { stacked: true },y: {stacked: true,beginAtZero: true,max: maxPrNum + 2,},},plugins: {title: {display: true,text: this.getChartTitle(data, fromDate, toDate),font: { size: 20 }},tooltip: {mode: "index",intersect: false,},}, onClick: (event, elements) => {if (elements.length > 0 && onClickCallback) {const index = elements[0].index;const person = data.labels[index];onClickCallback(person);}},};}/*** チャートを作成・更新* @param {Object} data - チャートデータ* @param {Function} onClickCallback - クリック時のコールバック*/createChart(data, onClickCallback) {const ctx = document.getElementById(this.canvasId).getContext("2d");const options = this.createChartOptions(data, onClickCallback);// 既存のチャートがあれば破棄if (this.chart instanceof Chart) {this.chart.destroy();}this.chart = new Chart(ctx, {type: "bar",data: data,options: options,});}/*** チャートを破棄*/destroy() {if (this.chart instanceof Chart) {this.chart.destroy();this.chart = null;}}}</script><script>
/*** モーダルの表示・管理を担当するクラス*/class ModalManager {constructor(modalId, modalContentId, closeButtonSelector) {this.modal = document.getElementById(modalId);this.modalContent = document.getElementById(modalContentId);this.closeBtn = document.querySelector(closeButtonSelector);this.setupEventListeners();}/*** イベントリスナーを設定*/setupEventListeners() {// モーダルを閉じるボタンのイベントif (this.closeBtn) {this.closeBtn.onclick = () => this.close();}// モーダル外クリックで閉じるif (this.modal) {this.modal.addEventListener('click', (event) => {if (event.target === this.modal) {this.close();}});}}/*** モーダルを表示*/show() {this.modal.style.display = "block";}/*** モーダルを閉じる*/close() {this.modal.style.display = "none";}/*** モーダルコンテンツをクリア*/clearContent() {this.modalContent.innerHTML = "";}/*** モーダルにコンテンツを追加* @param {HTMLElement} content - 追加するコンテンツ*/appendContent(content) {this.modalContent.appendChild(content);}/*** モーダルタイトルを設定* @param {string} title - タイトル*/setTitle(title) {const titleElement = document.createElement("h2");titleElement.textContent = title;this.appendContent(titleElement);}}</script><script>
/*** PRテーブルの作成と管理を担当するクラス*/class TableBuilder {constructor() {this.dateUtils = new DateUtils();}/*** PRデータを表に挿入* @param {Array} prs - PRデータ配列* @param {HTMLElement} tbody - テーブルのtbody要素* @param {boolean} isCompleted - 完了済みかどうか*/insertPRData(prs, tbody, isCompleted = false) {prs.forEach((pr) => {const row = document.createElement("tr");const isClosedPR = pr.status.toLowerCase().includes("close");if (isClosedPR) {row.classList.add("closed");}if (isCompleted) {row.classList.add("completed");}const createdDay = new Date(pr.created_day);const strCreatedDay = this.dateUtils.formatDate(createdDay);let strClosedDay;if (pr.closed_day === null) {strClosedDay = "-";} else {const closedDay = new Date(pr.closed_day);strClosedDay = this.dateUtils.formatDate(closedDay);}const numComments = pr.num_comments || 0;let lifetime;if (pr.lifetime_day === null) {lifetime = "-";} else {lifetime = pr.lifetime_day * 24 + pr.lifetime_hour + "h";}let firstReview;if (pr.first_review_min === null) {firstReview = "-";} else {firstReview = pr.first_review_hour + "h" + pr.first_review_min + "m";}row.innerHTML = `<td>${strCreatedDay}</td><td>${strClosedDay}</td><td>${lifetime}</td><td>${firstReview}</td><td>${pr.title}</td><td>${pr.status}</td><td>${numComments}</td><td><a href="${pr.html_url}" target="_blank">Link</a></td>`;tbody.appendChild(row);});}/*** Author PRsのテーブルを作成* @param {Array} authorPrs - AuthorのPRデータ* @returns {DocumentFragment} テーブルコンテンツ*/createAuthorTable(authorPrs) {const template = document.getElementById("pr-table-template");const authorTableContent = template.content.cloneNode(true);const tableAuth = authorTableContent.querySelector("table");tableAuth.classList.add("pr-table-author");const tbodyAuthor = authorTableContent.querySelector("tbody");this.insertPRData(authorPrs, tbodyAuthor);return authorTableContent;}/*** Requested PRsのテーブルを作成* @param {Array} requestedPrs - リクエストされたPRデータ* @param {Array} completedPrs - 完了済みPRデータ* @returns {Object} テーブルコンテンツと表要素*/createRequestedTable(requestedPrs, completedPrs) {const template = document.getElementById("pr-table-template");const requestedTableContent = template.content.cloneNode(true);const tableReq = requestedTableContent.querySelector("table");tableReq.classList.add("pr-table-requested");const tbodyRequested = requestedTableContent.querySelector("tbody");// リクエストされたPRとレビュー済みPRを追加this.insertPRData(requestedPrs, tbodyRequested);this.insertPRData(completedPrs, tbodyRequested, true);return { tableContent: requestedTableContent, table: tableReq };}/*** 完了済みPRの表示/非表示トグルを作成* @param {HTMLElement} tableReq - テーブル要素* @returns {DocumentFragment} トグルコンテンツ*/createCompletedToggle(tableReq) {const toggleTemplate = document.getElementById("completed-toggle-template");const toggleContent = toggleTemplate.content.cloneNode(true);const toggleCheckbox = toggleContent.querySelector("#showCompletedToggle");// トグルのイベントリスナーを設定toggleCheckbox.addEventListener("change", function () {const completedRows = tableReq.querySelectorAll(".completed");completedRows.forEach(row => {row.style.display = this.checked ? "" : "none";});});return toggleContent;}/*** セクションヘッダーを作成* @param {string} title - タイトル* @param {DocumentFragment} toggleContent - トグルコンテンツ（オプション）* @returns {HTMLElement} ヘッダー要素*/createSectionHeader(title, toggleContent = null) {const header = document.createElement("div");header.style.display = "flex";header.style.alignItems = "center";header.style.marginBottom = "-20px";header.style.marginTop = "20px";const titleElement = document.createElement("h3");titleElement.textContent = title;titleElement.style.marginRight = "20px";header.appendChild(titleElement);if (toggleContent) {header.appendChild(toggleContent);}return header;}/*** レビュー済みPRを初期状態で非表示にする* @param {HTMLElement} tableReq - テーブル要素*/hideCompletedPRs(tableReq) {const completedRows = tableReq.querySelectorAll(".completed");completedRows.forEach(row => {row.style.display = "none";});}}</script><script>
/*** マルチセレクトドロップダウンコンポーネント*/class MultiSelectDropdown {constructor(containerId, options = {}) {this.containerId = containerId;this.options = {placeholder: options.placeholder || 'Select items...',searchPlaceholder: options.searchPlaceholder || 'Search...',selectAllText: options.selectAllText || 'Select All',deselectAllText: options.deselectAllText || 'Deselect All',noResultsText: options.noResultsText || 'No results found',selectedText: options.selectedText || 'selected',...options};this.container = null;this.selectedItems = new Set();this.items = [];this.isOpen = false;this.searchTerm = '';this.init();}/*** 初期化*/init() {this.container = document.getElementById(this.containerId);if (!this.container) {console.error(`Container with id "${this.containerId}" not found`);return;}this.render();this.setupEventListeners();}/*** コンポーネントをレンダリング*/render() {this.container.innerHTML = `<div class="multi-select-dropdown"><div class="multi-select-header"><div class="multi-select-selected-display"><span class="multi-select-placeholder">${this.options.placeholder}</span><span class="multi-select-selected-count" style="display: none;"></span></div><div class="multi-select-arrow">▼</div></div><div class="multi-select-dropdown-content" style="display: none;"><div class="multi-select-search-container"><input type="text" class="multi-select-search" placeholder="${this.options.searchPlaceholder}"></div><div class="multi-select-actions"><button class="multi-select-select-all">${this.options.selectAllText}</button><button class="multi-select-deselect-all">${this.options.deselectAllText}</button></div><div class="multi-select-items-container"><div class="multi-select-items"></div></div></div></div>`;this.dropdown = this.container.querySelector('.multi-select-dropdown');this.header = this.container.querySelector('.multi-select-header');this.dropdownContent = this.container.querySelector('.multi-select-dropdown-content');this.itemsContainer = this.container.querySelector('.multi-select-items');this.searchInput = this.container.querySelector('.multi-select-search');this.selectedDisplay = this.container.querySelector('.multi-select-selected-display');this.placeholder = this.container.querySelector('.multi-select-placeholder');this.selectedCount = this.container.querySelector('.multi-select-selected-count');}/*** イベントリスナーを設定*/setupEventListeners() {// ヘッダークリックでドロップダウンを開閉this.header.addEventListener('click', () => this.toggle());// 検索入力this.searchInput.addEventListener('input', (e) => {this.searchTerm = e.target.value.toLowerCase();this.renderItems();});// 全選択・全解除ボタンthis.container.querySelector('.multi-select-select-all').addEventListener('click', () => {this.selectAll();});this.container.querySelector('.multi-select-deselect-all').addEventListener('click', () => {this.deselectAll();});// ドロップダウン外クリックで閉じるdocument.addEventListener('click', (e) => {if (!this.container.contains(e.target)) {this.close();}});// 検索入力のクリックイベントの伝播を停止this.searchInput.addEventListener('click', (e) => {e.stopPropagation();});}/*** アイテムを設定* @param {Array} items - アイテムの配列 [{value: string, label: string, group?: string}]*/setItems(items) {this.items = items;this.renderItems();}/*** アイテムをレンダリング*/renderItems() {const filteredItems = this.items.filter(item =>item.label.toLowerCase().includes(this.searchTerm) ||(item.group && item.group.toLowerCase().includes(this.searchTerm)));if (filteredItems.length === 0) {this.itemsContainer.innerHTML = `<div class="multi-select-no-results">${this.options.noResultsText}</div>`;return;}// グループごとにアイテムを整理const grouped = {};const noGroup = [];filteredItems.forEach(item => {if (item.group) {if (!grouped[item.group]) {grouped[item.group] = [];}grouped[item.group].push(item);} else {noGroup.push(item);}});let html = '';// グループなしのアイテムnoGroup.forEach(item => {const checked = this.selectedItems.has(item.value) ? 'checked' : '';html += `<div class="multi-select-item" data-value="${item.value}"><input type="checkbox" id="ms-item-${item.value}" ${checked}><label for="ms-item-${item.value}">${item.label}</label></div>`;});// グループありのアイテムObject.keys(grouped).sort().forEach(group => {html += `<div class="multi-select-group"><div class="multi-select-group-header">${group}</div>`;grouped[group].forEach(item => {const checked = this.selectedItems.has(item.value) ? 'checked' : '';html += `<div class="multi-select-item" data-value="${item.value}"><input type="checkbox" id="ms-item-${item.value}" ${checked}><label for="ms-item-${item.value}">${item.label}</label></div>`;});html += '</div>';});this.itemsContainer.innerHTML = html;// チェックボックスのイベントリスナーthis.itemsContainer.querySelectorAll('.multi-select-item input').forEach(checkbox => {checkbox.addEventListener('change', (e) => {const value = e.target.closest('.multi-select-item').dataset.value;if (e.target.checked) {this.selectedItems.add(value);} else {this.selectedItems.delete(value);}this.updateSelectedDisplay();this.triggerChange();});});}/*** 選択状態の表示を更新*/updateSelectedDisplay() {const count = this.selectedItems.size;if (count === 0) {this.placeholder.style.display = 'inline';this.selectedCount.style.display = 'none';} else {this.placeholder.style.display = 'none';this.selectedCount.style.display = 'inline';if (count === 1) {const selectedValue = Array.from(this.selectedItems)[0];const item = this.items.find(i => i.value === selectedValue);this.selectedCount.textContent = item ? item.label : selectedValue;} else {this.selectedCount.textContent = `${count} ${this.options.selectedText}`;}}}/*** ドロップダウンを開閉*/toggle() {if (this.isOpen) {this.close();} else {this.open();}}/*** ドロップダウンを開く*/open() {this.dropdownContent.style.display = 'block';this.dropdown.classList.add('open');this.isOpen = true;this.searchInput.focus();}/*** ドロップダウンを閉じる*/close() {this.dropdownContent.style.display = 'none';this.dropdown.classList.remove('open');this.isOpen = false;this.searchTerm = '';this.searchInput.value = '';this.renderItems();}/*** 全選択*/selectAll() {const filteredItems = this.items.filter(item =>item.label.toLowerCase().includes(this.searchTerm) ||(item.group && item.group.toLowerCase().includes(this.searchTerm)));filteredItems.forEach(item => {this.selectedItems.add(item.value);});this.renderItems();this.updateSelectedDisplay();this.triggerChange();}/*** 全解除*/deselectAll() {if (this.searchTerm) {// 検索中の場合は表示されているアイテムのみ解除const filteredItems = this.items.filter(item =>item.label.toLowerCase().includes(this.searchTerm) ||(item.group && item.group.toLowerCase().includes(this.searchTerm)));filteredItems.forEach(item => {this.selectedItems.delete(item.value);});} else {// 検索していない場合は全て解除this.selectedItems.clear();}this.renderItems();this.updateSelectedDisplay();this.triggerChange();}/*** 選択されたアイテムを取得* @returns {Array} 選択されたアイテムの値の配列*/getSelected() {return Array.from(this.selectedItems);}/*** 選択状態を設定* @param {Array} values - 選択する値の配列*/setSelected(values) {this.selectedItems = new Set(values);this.renderItems();this.updateSelectedDisplay();}/*** 変更イベントをトリガー*/triggerChange() {const event = new CustomEvent('change', {detail: {selected: this.getSelected()}});this.container.dispatchEvent(event);}/*** コンポーネントを無効化*/disable() {this.dropdown.classList.add('disabled');this.header.style.pointerEvents = 'none';}/*** コンポーネントを有効化*/enable() {this.dropdown.classList.remove('disabled');this.header.style.pointerEvents = 'auto';}}
</script><script>
/*** オートコンプリート機能付き入力フィールドコンポーネント*/class AutocompleteInput {constructor(containerId, options = {}) {this.containerId = containerId;this.options = {placeholder: options.placeholder || 'Type to search...',separator: options.separator || ',',noResultsText: options.noResultsText || 'No results found',maxSuggestions: options.maxSuggestions || 10,minChars: options.minChars || 1,caseSensitive: options.caseSensitive || false,allowDuplicates: options.allowDuplicates || false,...options};this.container = null;this.input = null;this.suggestionsList = null;this.suggestions = [];this.selectedValues = new Set();this.currentFocus = -1;this.isOpen = false;this.init();}/*** 初期化*/init() {this.container = document.getElementById(this.containerId);if (!this.container) {console.error(`Container with id "${this.containerId}" not found`);return;}this.render();this.setupEventListeners();}/*** コンポーネントをレンダリング*/render() {this.container.innerHTML = `<div class="autocomplete-container"><div class="autocomplete-input-wrapper"><div class="autocomplete-tags"></div><input type="text" class="autocomplete-input" placeholder="${this.options.placeholder}"></div><div class="autocomplete-suggestions" style="display: none;"></div></div>`;this.inputWrapper = this.container.querySelector('.autocomplete-input-wrapper');this.input = this.container.querySelector('.autocomplete-input');this.tagsContainer = this.container.querySelector('.autocomplete-tags');this.suggestionsList = this.container.querySelector('.autocomplete-suggestions');}/*** イベントリスナーを設定*/setupEventListeners() {// 入力イベントthis.input.addEventListener('input', (e) => {this.handleInput(e.target.value);});// キーボードナビゲーションthis.input.addEventListener('keydown', (e) => {this.handleKeydown(e);});// フォーカス/ブラーthis.input.addEventListener('focus', () => {if (this.input.value.length >= this.options.minChars) {this.showSuggestions();}});this.input.addEventListener('blur', (e) => {// 遅延してブラーを処理（提案をクリックする時間を確保）setTimeout(() => {if (!this.container.contains(document.activeElement)) {this.hideSuggestions();}}, 150);});// 外部クリックで閉じるdocument.addEventListener('click', (e) => {if (!this.container.contains(e.target)) {this.hideSuggestions();}});// 入力ラッパーをクリックしたときに入力にフォーカスthis.inputWrapper.addEventListener('click', () => {this.input.focus();});}/*** 入力処理* @param {string} value - 入力値*/handleInput(value) {const trimmedValue = value.trim();// セパレーターでの区切り処理if (value.includes(this.options.separator)) {const parts = value.split(this.options.separator);const lastPart = parts.pop().trim();// セパレーター前の部分を追加parts.forEach(part => {const trimmedPart = part.trim();if (trimmedPart) {this.addValue(trimmedPart);}});// 最後の部分を入力フィールドに残すthis.input.value = lastPart;this.handleInput(lastPart);return;}if (trimmedValue.length >= this.options.minChars) {this.filterSuggestions(trimmedValue);this.showSuggestions();} else {this.hideSuggestions();}this.currentFocus = -1;}/*** キーボード処理* @param {KeyboardEvent} e - キーボードイベント*/handleKeydown(e) {const suggestions = this.suggestionsList.querySelectorAll('.autocomplete-suggestion:not(.disabled)');switch (e.key) {case 'ArrowDown':e.preventDefault();this.currentFocus = Math.min(this.currentFocus + 1, suggestions.length - 1);this.updateFocus(suggestions);break;case 'ArrowUp':e.preventDefault();this.currentFocus = Math.max(this.currentFocus - 1, -1);this.updateFocus(suggestions);break;case 'Enter':e.preventDefault();if (this.currentFocus >= 0 && suggestions[this.currentFocus]) {this.selectSuggestion(suggestions[this.currentFocus].textContent);} else if (this.input.value.trim()) {this.addValue(this.input.value.trim());}break;case 'Escape':this.hideSuggestions();this.input.blur();break;case 'Backspace':if (!this.input.value && this.selectedValues.size > 0) {// 入力が空でタグがある場合、最後のタグを削除const values = Array.from(this.selectedValues);this.removeValue(values[values.length - 1]);}break;}}/*** フォーカス更新* @param {NodeList} suggestions - 提案要素リスト*/updateFocus(suggestions) {suggestions.forEach((suggestion, index) => {if (index === this.currentFocus) {suggestion.classList.add('focused');} else {suggestion.classList.remove('focused');}});}/*** 提案をフィルタリング* @param {string} query - 検索クエリ*/filterSuggestions(query) {const searchQuery = this.options.caseSensitive ? query : query.toLowerCase();const filtered = this.suggestions.filter(suggestion => {const suggestionText = this.options.caseSensitive ? suggestion : suggestion.toLowerCase();const isMatch = suggestionText.includes(searchQuery);const isAlreadySelected = this.selectedValues.has(suggestion);return isMatch && (!isAlreadySelected || this.options.allowDuplicates);});this.renderSuggestions(filtered.slice(0, this.options.maxSuggestions));}/*** 提案をレンダリング* @param {Array} filteredSuggestions - フィルタリングされた提案*/renderSuggestions(filteredSuggestions) {if (filteredSuggestions.length === 0) {this.suggestionsList.innerHTML = `<div class="autocomplete-no-results">${this.options.noResultsText}</div>`;} else {const html = filteredSuggestions.map(suggestion => `<div class="autocomplete-suggestion" data-value="${suggestion}">${this.highlightMatch(suggestion)}</div>`).join('');this.suggestionsList.innerHTML = html;// 提案のクリックイベントthis.suggestionsList.querySelectorAll('.autocomplete-suggestion').forEach(item => {item.addEventListener('click', () => {this.selectSuggestion(item.dataset.value);});});}}/*** マッチした部分をハイライト* @param {string} text - テキスト* @returns {string} ハイライト済みHTML*/highlightMatch(text) {const query = this.input.value.trim();if (!query) return text;const regex = new RegExp(`(${query})`, this.options.caseSensitive ? 'g' : 'gi');return text.replace(regex, '<mark>$1</mark>');}/*** 提案を選択* @param {string} value - 選択された値*/selectSuggestion(value) {this.addValue(value);this.hideSuggestions();}/*** 値を追加* @param {string} value - 追加する値*/addValue(value) {const trimmedValue = value.trim();if (!trimmedValue) return;if (!this.options.allowDuplicates && this.selectedValues.has(trimmedValue)) {this.input.value = '';return;}this.selectedValues.add(trimmedValue);this.input.value = '';this.renderTags();this.hideSuggestions();this.triggerChange();}/*** 値を削除* @param {string} value - 削除する値*/removeValue(value) {this.selectedValues.delete(value);this.renderTags();this.triggerChange();}/*** タグをレンダリング*/renderTags() {const html = Array.from(this.selectedValues).map(value => `<div class="autocomplete-tag"><span class="autocomplete-tag-text">${value}</span><button class="autocomplete-tag-remove" data-value="${value}">×</button></div>`).join('');this.tagsContainer.innerHTML = html;// 削除ボタンのイベントthis.tagsContainer.querySelectorAll('.autocomplete-tag-remove').forEach(btn => {btn.addEventListener('click', (e) => {e.stopPropagation();this.removeValue(btn.dataset.value);});});// プレースホルダーの表示制御if (this.selectedValues.size > 0) {this.input.placeholder = '';} else {this.input.placeholder = this.options.placeholder;}}/*** 提案を表示*/showSuggestions() {this.suggestionsList.style.display = 'block';this.isOpen = true;this.container.classList.add('open');}/*** 提案を非表示*/hideSuggestions() {this.suggestionsList.style.display = 'none';this.isOpen = false;this.container.classList.remove('open');this.currentFocus = -1;}/*** 提案リストを設定* @param {Array} suggestions - 提案の配列*/setSuggestions(suggestions) {this.suggestions = [...suggestions];}/*** 選択された値を取得* @returns {Array} 選択された値の配列*/getValues() {return Array.from(this.selectedValues);}/*** 値を設定* @param {Array|string} values - 設定する値*/setValues(values) {if (typeof values === 'string') {values = values.split(this.options.separator).map(v => v.trim()).filter(v => v);}this.selectedValues = new Set(values);this.renderTags();this.triggerChange();}/*** 値をクリア*/clear() {this.selectedValues.clear();this.input.value = '';this.renderTags();this.hideSuggestions();this.triggerChange();}/*** 変更イベントをトリガー*/triggerChange() {const event = new CustomEvent('change', {detail: {values: this.getValues()}});this.container.dispatchEvent(event);}/*** フォーカス*/focus() {this.input.focus();}/*** 無効化*/disable() {this.input.disabled = true;this.container.classList.add('disabled');}/*** 有効化*/enable() {this.input.disabled = false;this.container.classList.remove('disabled');}}
</script><script>
/*** チーム管理を担当するクラス*/class TeamManager {constructor(apiService, notificationManager) {this.apiService = apiService;this.notificationManager = notificationManager;this.teams = {};this.teamDropdown = null;this.initDropdown();}/*** ドロップダウンを初期化*/initDropdown() {this.teamDropdown = new MultiSelectDropdown('teamDropdown', {placeholder: 'Select teams (All teams if none selected)',searchPlaceholder: 'Search teams...',selectAllText: 'Select All',deselectAllText: 'Clear Selection',noResultsText: 'No teams found',selectedText: 'teams selected'});}/*** チーム情報を読み込み*/async loadTeams() {try {const data = await this.apiService.getTeams();this.teams = data.teams;this.updateDropdownItems();return this.teams;} catch (error) {console.error("Error loading teams:", error);this.notificationManager.showError("チーム情報の読み込みに失敗しました");}}/*** ドロップダウンのアイテムを更新*/updateDropdownItems() {const items = [];// チームをアイテムに変換for (const [teamName, members] of Object.entries(this.teams)) {items.push({value: teamName,label: `${teamName} (${members.length} members)`,group: 'Teams'});}if (this.teamDropdown) {this.teamDropdown.setItems(items);}}/*** チーム情報を更新*/async updateTeamInfo() {this.notificationManager.showLoading("チーム情報を更新中...");try {const data = await this.apiService.updateTeams();if (data.error) {throw new Error(data.error);}// チーム情報を再読み込みawait this.loadTeams();this.notificationManager.showSuccess("チーム情報が正常に更新されました");} catch (error) {console.error("Error:", error);this.notificationManager.showError("チーム情報の更新に失敗しました");} finally {this.notificationManager.hideLoading();}}/*** 選択されたチームを取得* @returns {Array<string>} 選択されたチーム名の配列*/getSelectedTeams() {if (!this.teamDropdown) {return [];}return this.teamDropdown.getSelected();}/*** 選択されたチームを設定* @param {Array<string>} teams - 設定するチーム名の配列*/setSelectedTeams(teams) {if (this.teamDropdown) {this.teamDropdown.setSelected(teams);}}/*** 選択されたチームとユーザーを取得* @param {UserManager} userManager - ユーザーマネージャー* @returns {Object} 選択されたチームとユーザー*/getSelectedTeamsAndUsers(userManager) {// 選択されたチーム を取得（何も選択されていない場合は全チーム扱い）const selectedTeams = this.getSelectedTeams();// 選択されたユーザーを取得const users = userManager ? userManager.getSelectedUsers() : [];return { teams: selectedTeams, users };}/*** ドロップダウンにイベントリスナーを追加* @param {Function} callback - 選択が変更されたときのコールバック*/onSelectionChange(callback) {if (this.teamDropdown) {const container = document.getElementById('teamDropdown');container.addEventListener('change', callback);}}/*** ドロップダウンを無効化*/disable() {if (this.teamDropdown) {this.teamDropdown.disable();}}/*** ドロップダウンを有効化*/enable() {if (this.teamDropdown) {this.teamDropdown.enable();}}}
</script><script>
/*** ユーザー管理とオートコンプリート機能を担当するクラス*/class UserManager {constructor(apiService) {this.apiService = apiService;this.userAutocomplete = null;this.allUsers = new Set();this.initAutocomplete();}/*** オートコンプリートを初期化*/initAutocomplete() {this.userAutocomplete = new AutocompleteInput('usersAutocomplete', {placeholder: 'user1, user2, user3...',separator: ',',noResultsText: 'No users found',maxSuggestions: 8,minChars: 1,caseSensitive: false,allowDuplicates: false});}/*** チームデータからユーザーリストを取得・更新* @param {Object} teams - チームデータ*/updateUsersFromTeams(teams) {if (!teams) return;// チームからユーザー名を抽出for (const [teamName, members] of Object.entries(teams)) {if (Array.isArray(members)) {members.forEach(user => {if (typeof user === 'string' && user.trim()) {this.allUsers.add(user.trim());}});}}this.updateSuggestions();}/*** PRデータからユーザーリストを更新* @param {Object} data - PRデータ*/async updateUsersFromPRData(data) {if (!data || !data.pr_details) return;try {// PRデータから作成者、レビュー要求者、完了者を抽出data.pr_details.forEach(pr => {// 作成者if (pr.author && typeof pr.author === 'string') {this.allUsers.add(pr.author.trim());}// レビュー要求者if (Array.isArray(pr.requested)) {pr.requested.forEach(user => {if (typeof user === 'string' && user.trim()) {this.allUsers.add(user.trim());}});}// 完了者if (Array.isArray(pr.completed)) {pr.completed.forEach(user => {if (typeof user === 'string' && user.trim()) {this.allUsers.add(user.trim());}});}});this.updateSuggestions();} catch (error) {console.error('Error updating users from PR data:', error);}}/*** オートコンプリートの提案リストを更新*/updateSuggestions() {if (this.userAutocomplete) {const sortedUsers = Array.from(this.allUsers).sort((a, b) =>a.toLowerCase().localeCompare(b.toLowerCase()));this.userAutocomplete.setSuggestions(sortedUsers);}}/*** 選択されたユーザーを取得* @returns {Array<string>} 選択されたユーザー名の配列*/getSelectedUsers() {if (!this.userAutocomplete) {return [];}return this.userAutocomplete.getValues();}/*** 選択されたユーザーを設定* @param {Array<string>|string} users - 設定するユーザー名*/setSelectedUsers(users) {if (this.userAutocomplete) {this.userAutocomplete.setValues(users);}}/*** ユーザー選択をクリア*/clearSelectedUsers() {if (this.userAutocomplete) {this.userAutocomplete.clear();}}/*** 既知のユーザー名を手動で追加* @param {string|Array<string>} users - 追加するユーザー名*/addKnownUsers(users) {if (typeof users === 'string') {users = [users];}if (Array.isArray(users)) {users.forEach(user => {if (typeof user === 'string' && user.trim()) {this.allUsers.add(user.trim());}});this.updateSuggestions();}}/*** 特定のユーザー名パターンを除外* @param {Array<string>} patterns - 除外するパターン*/excludeUserPatterns(patterns) {if (!Array.isArray(patterns)) return;const filteredUsers = Array.from(this.allUsers).filter(user => {return !patterns.some(pattern => {if (typeof pattern === 'string') {return user.includes(pattern);}if (pattern instanceof RegExp) {return pattern.test(user);}return false;});});this.allUsers = new Set(filteredUsers);this.updateSuggestions();}/*** オートコンプリートに変更リスナーを追加* @param {Function} callback - 変更時のコールバック*/onSelectionChange(callback) {if (this.userAutocomplete) {const container = document.getElementById('usersAutocomplete');if (container) {container.addEventListener('change', callback);}}}/*** オートコンプリートを無効化*/disable() {if (this.userAutocomplete) {this.userAutocomplete.disable();}}/*** オートコンプリートを有効化*/enable() {if (this.userAutocomplete) {this.userAutocomplete.enable();}}/*** フォーカス*/focus() {if (this.userAutocomplete) {this.userAutocomplete.focus();}}/*** すべての既知ユーザーを取得* @returns {Array<string>} すべてのユーザー名の配列*/getAllKnownUsers() {return Array.from(this.allUsers).sort((a, b) =>a.toLowerCase().localeCompare(b.toLowerCase()));}/*** ユーザー数を取得* @returns {number} 既知ユーザーの数*/getUserCount() {return this.allUsers.size;}}
</script><script>
/*** GitHubアナライザーのメインコントローラークラス* 各コンポーネントを統合して全体の動作を制御*/class GitHubAnalyzerController {constructor() {this.apiService = new GitHubApiService();this.dataProcessor = new DataProcessor();this.chartManager = new ChartManager('reviewChart', this.dataProcessor);this.modalManager = new ModalManager('prModal', 'prModalContent', '.close');this.tableBuilder = new TableBuilder();this.dateUtils = new DateUtils();this.notificationManager = new NotificationManager();this.teamManager = new TeamManager(this.apiService, this.notificationManager);this.userManager = new UserManager(this.apiService);this.init();}/*** 初期化処理*/init() {this.setupEventListeners();this.loadTeams();this.setDefaultDates();this.updateChart();}/*** イベントリスナーを設定*/setupEventListeners() {// 手動日付選択のボタンdocument.getElementById("runButton")?.addEventListener("click", () => {this.handleManualDateSelection();});// 週間ボタンdocument.getElementById("weekly-btn")?.addEventListener("click", () => {this.handleWeeklyData();});// 月間ボタンdocument.getElementById("monthly-btn")?.addEventListener("click", () => {this.handleMonthlyData();});// チーム更新ボタンdocument.getElementById("updateTeamsButton")?.addEventListener("click", () => {this.updateTeamInfo();});}/*** 手動日付選択の処理*/handleManualDateSelection() {const fromDate = document.getElementById("fromDateInput").value;const toDate = document.getElementById("toDateInput").value;if (!fromDate || !toDate) {this.notificationManager.showAlert("両方の日付を選択してください");return;}const { teams, users } = this.teamManager.getSelectedTeamsAndUsers(this.userManager);this.fetchGithubData(fromDate, toDate, teams, users);}/*** 週間データの処理*/handleWeeklyData() {const toDate = this.dateUtils.getToday();const fromDate = this.dateUtils.getDaysAgo(7);const { teams, users } = this.teamManager.getSelectedTeamsAndUsers(this.userManager);this.fetchGithubData(fromDate, toDate, teams, users);}/*** 月間データの処理*/handleMonthlyData() {const toDate = this.dateUtils.getToday();const fromDate = this.dateUtils.getDaysAgo(30);const { teams, users } = this.teamManager.getSelectedTeamsAndUsers(this.userManager);this.fetchGithubData(fromDate, toDate, teams, users);}/*** GitHubデータを取得* @param {string} fromDate - 開始日* @param {string} toDate - 終了日* @param {Array<string>} teams - チーム名の配列* @param {Array<string>} users - ユーザー名の配列*/async fetchGithubData(fromDate, toDate, teams = [], users = []) {this.notificationManager.showLoading("Fetching data from Github...");try {const data = await this.apiService.fetchData(fromDate, toDate, teams, users);if (data.error) {throw new Error(data.error);}this.notificationManager.showSuccess("Successfully data updated");this.updateChart();} catch (error) {console.error("Error:", error);this.notificationManager.showError("Failed to fetch or parse data");} finally {this.notificationManager.hideLoading();}}/*** チャートを更新*/async updateChart() {try {const data = await this.apiService.getReviewData();// ユーザー情報をPRデータから更新await this.userManager.updateUsersFromPRData(data);// データ処理const filteredData = this.dataProcessor.filterNonMembers(data);const configuredData = this.dataProcessor.configureDatasets(filteredData);// チャートの作成this.chartManager.createChart(configuredData, (person) => {this.showAuthorPRs(person);});} catch (error) {console.error("Error:", error);this.notificationManager.showError();}}/*** 作成者のPR情報を表示* @param {string} person - 対象者*/async showAuthorPRs(person) {try {const data = await this.apiService.getReviewData();const prData = data["pr_details"];const { authorPrs, requestedPrs, completedPrs } =this.dataProcessor.filterPRsByPerson(prData, person);this.displayOnModal(person, authorPrs, requestedPrs, completedPrs);} catch (error) {console.error("Error fetching PR info:", error);this.notificationManager.showError("PR情報の取得に失敗しました");}}/*** モーダルにPR情報を表示* @param {string} person - 対象者* @param {Array} authorPrs - 作成者のPR* @param {Array} requestedPrs - リクエストされたPR* @param {Array} completedPrs - 完了済みPR*/displayOnModal(person, authorPrs, requestedPrs, completedPrs) {// モーダルコンテンツをクリアthis.modalManager.clearContent();// タイトルを設定this.modalManager.setTitle(`${person}'s PRs`);// Authorテーブルを作成const authorTableContent = this.tableBuilder.createAuthorTable(authorPrs);const authorHeader = this.tableBuilder.createSectionHeader("Author");this.modalManager.appendContent(authorHeader);this.modalManager.appendContent(authorTableContent);// Requestedテーブルを作成const { tableContent: requestedTableContent, table: tableReq } =this.tableBuilder.createRequestedTable(requestedPrs, completedPrs);const toggleContent = this.tableBuilder.createCompletedToggle(tableReq);const requestedHeader = this.tableBuilder.createSectionHeader("Requested", toggleContent);// レビュー済みPRを初期状態で非表示this.tableBuilder.hideCompletedPRs(tableReq);this.modalManager.appendContent(requestedHeader);this.modalManager.appendContent(requestedTableContent);// モーダルを表示this.modalManager.show();}/*** デフォルトの日付を設定*/async setDefaultDates() {try {const data = await this.apiService.getReviewData();const fromDate = data["period"][0];const toDate = data["period"][1];const toDateInput = document.getElementById("toDateInput");const fromDateInput = document.getElementById("fromDateInput");if (fromDateInput) fromDateInput.value = fromDate;if (toDateInput) toDateInput.value = toDate;} catch (error) {console.error("Error setting default dates:", error);}}/*** チーム情報を読み込み*/async loadTeams() {const teams = await this.teamManager.loadTeams();// チームデータからユーザー情報を更新if (teams) {this.userManager.updateUsersFromTeams(teams);}// ボット系ユーザーを除外this.userManager.excludeUserPatterns(['bot','[bot]','dependabot','github-actions']);}/*** チーム情報を更新*/async updateTeamInfo() {await this.teamManager.updateTeamInfo();}}// DOMContentLoadedでアプリケーションを自動初期化document.addEventListener("DOMContentLoaded", () => {const analyzer = new GitHubAnalyzerController();});</script></body></html>